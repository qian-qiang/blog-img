---
title: 嵌入式软件框架方案
top: false
cover: false
toc: true
mathjax: true
date: 2023-07-15 21:54:34
password:
summary:
tags:
- Embedded system
categories:
- Embedded system
keywords:
description:
---

| 文件类型               | 研发过程文档   | 机密等级 | 机密     |
|------------------------|----------------|----------|----------|
| 文件编号               |                | 版本     | V1.0     |
| 撰 写 人               |                | 日期     |          |
| 审 核 人               |                | 日期     |          |
| 批 准 人               |                | 日期     |          |
| 项目名称               | XXX开发        |          |          |
| **嵌入式软件框架设计** |                |          |          |
| **相 关 文 档**        |                |          |          |
| 文件编号               | 文件名称       | 版本     |          |
|                        | 产品需求       |          |          |
|                        | 用户需求       |          |          |
|                        | 嵌入式软件需求 |          |          |
|                        |                |          |          |
|                        |                |          |          |
|                        |                |          |          |
|                        |                |          |          |
|                        |                |          |          |
| **修 订 记 录**        |                |          |          |
| 版本                   | 修订内容       | 修订人   | 修订日期 |
| V1.0                   | 创建           |          |          |
|                        |                |          |          |
|                        |                |          |          |
|                        |                |          |          |
|                        |                |          |          |
|                        |                |          |          |
|                        |                |          |          |

**目 录**

[0 版本记录](#_Toc57747469)

[1 引言](#引言)

[1.1 目的](#_Toc57747471)

[1.2 背景](#_Toc57747472)

[1.3 项目概述](#_Toc57747473)

[1.4 术语与缩略语](#_Toc57747474)

[1.5 引用文件](#_Toc57747475)

[2 架构目标与设计约束](#_Toc57747476)

[2.1 目标产品/目标产品系列](#_Toc57747477)

[2.2 功能需求](#_Toc57747478)

[2.3 上下文图](#上下文图)

[2.4 质量需求](#_Toc57747480)

[2.5 来自技术路线的约束：开发与运行环境限制](#来自技术路线的约束开发与运行环境限制)

[2.6 来自硬件设计的约束：嵌入式硬件变化分析](#_Toc57747482)

[2.7 来自上游方案的约束：整机配置变化分析](#来自上游方案的约束整机配置变化分析)

[2.8 来自上游方案的约束：方案部署变化分析](#_Toc57747484)

[3 架构思想](#_Toc57747485)

[3.1 思想一：避免瓶颈、提高性能 【强制，嵌入式软件必须】](#_Toc57747486)

[3.2 思想二：XXXXX](#思想二模块设计)

[3.3 思想三：XXXXX](#思想三子系统设计)

[4 架构设计](#_Toc57747489)

[4.1 逻辑视图](#_Toc57747490)

[4.2 产品/平台分工开发视图](#产品平台分工开发视图)

[4.3 运行视图](#运行视图)

[4.4 物理视图](#物理视图)

[5 接口设计](#接口设计)

[5.1 对外接口总览](#_Toc57747495)

[5.2 各模块间接口总览](#各模块间接口总览)

[5.3 平台和设备间接口总览](#_Toc57747497)

[5.4 接口列表](#接口列表)

[5.5 XXXXX接口设计](#xxxxx接口设计)

[5.6 XXXXX接口设计](#xxxxx接口设计-1)

[6 关键功能的设计原理](#_Toc57747501)

[6.1 XXXXX功能设计](#xxxxx功能设计)

[6.2 XXXXX功能设计](#xxxxx功能设计-1)

[7 关键质量的设计原理](#_Toc57747504)

[7.1 XXXX设计](#_Toc57747505)

[7.2 XXXX设计](#xxxx设计-1)

[7.3 XXXX设计](#xxxx设计-2)

[8 对CBB管理的影响](#_Toc57747508)

[8.1 本设计重用的CBB](#_Toc57747509)

[8.2 本设计贡献的新CBB](#_Toc57747510)

[8.3 本设计对现有CBB的升级需求](#_Toc57747511)

# 引言

## 目的

*简要说明本文档的编写目的、用途和适用范围。*

*【注意项】本节写“文档目的”，并非“项目目的”。*

*【示例】*

*本架构设计说明书编写的目的是……。本说明书的预期读者为系统设计人员、软件开发人员、软件测试人员和项目评审人员。*

## 背景

*简要说明产业背景、企业立项本项目的背景。*

## 项目概述

*简要说明项目内容、特点。*

*【注意项】本节十分简洁，待到后续“2.1 目标产品/目标产品系列”适当展开。*

## 术语与缩略语

*本节集中说明和解释文档涉及的行业词汇、专业术语、首字母缩略语，提高文档可读性。*

*【注意项】本节不可不写。*

| **词汇** | **解释** |
|----------|----------|
|          |          |
|          |          |
|          |          |

## 引用文件

*应列出本文档引用的所有文档的编号、标题、修订版本和日期，方便读者查阅参考。*

*【注意项】文档编号为□□公司为文档赋予的唯一正规编号。文档编号、文档版本号，均必写。*

| **文档编号** | **文档名称** | **版本号** | **文档日期** |
|--------------|--------------|------------|--------------|
|              |              |            |              |
|              |              |            |              |
|              |              |            |              |
|              |              |            |              |

# 架构目标与设计约束

*对于XX厂商，影响嵌入式软件架构设计大方向的不仅有功能需求、更有接口需求、运行开销约束、配置形态需求等。*

*此节对后续架构设计的具体展开，具有重大指导、和方向性影响。*

## 目标产品/目标产品系列

*设备软件的研发有何特点？*

*架构设计期能不能更有作为？*

*多个相似产品的架构设计能否重用？*

*设备软件有明显的“产品系列”特点，企业更是希望提高软件通用性与设计复用性，从而降成本。因此，本节应明确认真地说明：*

*A）本架构设计文档是针对具体的一个产品、还是由多个产品组成的产品系列。*

*B）如果针对产品系列，应对比其中各产品的关键能力、关键指标的不同。使读者有大局观。*

*【注意项】面向产品系列而设计的架构，文档后续注意通用性设计、适应性设计的描述。*

*概述目标产品，可以表格方式说明*

| **架构设计针对的目标产品** | **产品说明** |
|----------------------------|--------------|
| Xx产品                     |              |
| Yy产品                     |              |
| Zz产品                     |              |

*对比产品不同，可以《产品系列对比表》形式说明*

*![](media/e852708ffd1c78efd87949efa7b31592.png)*

## 功能需求

### 功能树/功能列表

*本节以功能树、功能表格等方式描述功能范围。*

*注意1：无需展开描述。*

*注意2：全面涵盖待研发的嵌入式设备软件的功能范围。*

*【示例】功能树*

![](media/dc4e3ddfdab5a0456af40df7d0a9238b.png)

### 产品系列功能对比表

*针对 “目标产品系列”的架构文档，请提供产品系列功能对比表。*

*【注意项】针对“单个目标产品”的文档，请写“本节无内容”。*

*【示例】产品系列功能特性对比表*

*![](media/2dd308b3411c41658cce041f8c230853.png)*

### * *关键功能识别与问题单分析

*【背景1】关键需求决定架构。当设计需要权衡时，照顾的是关键需求。方法！*

*【背景2】企业的问题单数据库，记录了同类系统暴露过的重大问题。风险！*

*本节督促架构师去分析历史问题、提高设计针对性、避免问题重演：*

*A）列出关键功能。文档后续的“6关键功能的设计原理”一节，应分别展开每个功能的设计。*

*B）列出对问题单的单号、描述、风险点分析。设计时解决之。*

*推荐描述形式*

| **关键功能** | **问题单分析** |              |              |
|--------------|----------------|--------------|--------------|
|              | **单号**       | **历史问题** | **设计风险** |
|              | \#n            |              |              |
|              | \#m            |              |              |
|              | \#n            |              |              |
|              | \#m            |              |              |
|              | \#n            |              |              |
|              | \#m            |              |              |
|              | \#n            |              |              |
|              | \#m            |              |              |

## 上下文图

*本节以顶层数据流图的形式，描述XX软件的上下文，即与外部哪些其他控制器、硬件单元、软件系统等有接口。*

*【示例】*

## 质量需求

*本节内容：*

1.  *TODO XX公司应制定《嵌入式软件质量属性标准》，本节包含哪些小节应当与之一一对应。类似XX公司的系统工程化设计要求的“五可”：可靠性、可测试性、可生产性、可安装性，可服务性。*
2.  *本节应覆盖来自高层需求文档的全部“质量指标”。*
3.  *本节求全，不求细。不写场景，不写因素分解。*

*制定《嵌入式软件质量属性标准》的参考一：某质量分类标准*

| *运行期质量属性*                                                                                                                                                                                       | *开发期质量属性*                                                                                                                                                         |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| *性能（Performance）* *安全性（Security）* *易用性（Usability）* *持续可用性（Availability）* *可伸缩性（Scalability）* *互操作性（Interoperability）* *可靠性（Reliability）* *鲁棒性（Robustness）*  | *易理解性（Understandability）* *可扩展性（Extensibility）* *可重用性（Reusability）* *可测试性（Testability）* *可维护性（Maintainability）* *可移植性（Portability）*  |

*制定《嵌入式软件质量属性标准》的参考二：性能五项*

*![](media/6aadad4da134377249d84bab5dbdfa8d.png)*

### XXXX

*该项质量的文字简述。不展开。*

### XXXX

*该项质量的文字简述。不展开。*

## 来自技术路线的约束：开发与运行环境限制

*公司的技术路线与技术战略中，包含了软件研发类技术选型的考虑，具体产品的架构师往往没有权力任意改变技术选型。本节内容：*

1.  *简述技术选型约束*
2.  *分析技术选型对关键资源的开销*

### 开发环境约定

*简单列举嵌入式软件研发的公司约定：开发语言、编译环境、本公司开发平台等。*

### 运行环境约定

*简单列举嵌入式软件研发的公司约定：硬件要求、操作系统、关系数据、实时数据库等。*

### 选型的资源开销分析：CPU资源

*资源紧、效率关键是嵌入式开发的特点。本节分析上述技术选型带来的CPU资源开销：*

-   *CPU占用率、*
-   *最大最小值、*
-   *可能的架构风险。*

### 选型的资源开销分析：内存资源

*资源紧、效率关键是嵌入式开发的特点。本节分析上述技术选型带来的内存资源开销：*

-   *内存占用率、*
-   *最大最小值、*
-   *可能的架构风险。*

### 选型的资源开销分析：Flash资源

*资源紧、效率关键是嵌入式开发的特点。本节分析上述技术选型带来的存储空间资源开销：*

-   *存储空间占用率、*
-   *最大最小值、*
-   *可能的架构风险。*

*【例如】例如Log组件高频度存储日志会消耗极多存储空间。架构师应尽早考虑如下影响：*

-   *对于软件包大小的限制*
-   *其他软件包大小的规划*
-   *LOG存储策略、存储频度的考虑*

## 来自硬件设计的约束：嵌入式硬件变化分析

*本节通过多个硬件结构框图，列出所有（即穷举）可能的嵌入式硬件结构。这对后续架构的驱动层设计有直接影响。*

*【FAQ】如果硬件设计还未完成，我要如何穷举所有可能的嵌入式硬件结构？*

*【答】架构设计开始较早，这决定了架构师和程序员的一个极大不同，即软件架构师“时刻保持和硬件设计师的直接沟通”、“不应等待正式的《硬件设计文档》发布后才开始设计”。这一点，和程序员“在正式《需求规格》发布后才编程”有极大不同。*

*【示例1】*

*![](media/32643a6fbe010dcc95af301416619164.png)*

## 来自上游方案的约束：整机配置变化分析

*整机配置，指一台整机设备内如下不同：*

-   *背板总线类型*
-   *主控板类型*
-   *主控板是否有主备、是否有群集*
-   *非主控板的数量*
-   *非主控板的种类*

*本节通过多个图，列出所有（即穷举）可能的整机配置。*

*【示例】*

*![](media/22c7469876239933b38a12a32e9c6f16.png)*

# 架构思想

*作为架构师，你在本节，应当重点突出地说明有价值、有独特性的2\~3条设计思想。*

-   *例如，嵌入式软件可用的CPU、内存等资源有限，你的规划思想规划原则是什么*
-   *例如，你如何运用状态机处理核心硬件的复杂状态组合*
-   *……*

## 思想一：避免瓶颈、提高性能 【强制，嵌入式软件必须】

*分析关键资源约束，并在此给出相应的设计准则：*

-   *例如，如果CPU是瓶颈，应约定“最大线程数限制”等设计原则并具体说明*
-   *例如，如果内存是瓶颈，应约定“限制Cache滥用”等设计原则并具体说明*
-   *例如，如果Flash紧缺，应约定“限制Log存储频率”等设计原则并具体说明*

## 思想二：模块设计

*只需重点突出地说明有价值、有独特性的2\~3条设计思想。*

## 思想三：子系统设计

*只需重点突出地说明有价值、有独特性的2\~3条设计思想。*

# 架构设计

## 逻辑视图

### 功能子系统划分

*纵切：功能子系统*

*列出或画出包含的功能子系统，并说明。*

### 系统分层架构

*横切：逻辑层*

*此处描述分层架构，有时采用“*系统分层架构**+**每层所用技术*”的形式将重要技术选型也描述进来。*

*【示例】*

## 产品/平台分工开发视图

**【开发视图 vs. 产品/平台分工开发视图】**

*开发视图，5视图之一，是单一视图——产品开发单元的切分，没有涉及平台扩充。*

*产品/平台分工开发视图，是混合视图——产品要开发，同时平台要生长扩充。*

**【本节内容】**

*首先，要说清功能需求映射到产品组件、还是平台组件。*

*其次，要说明平台总共要增加哪些组件、增强哪些组件。*

*最后，才是详细说明产品组件有哪些、又分别对应哪些代码工程。*

### 需求映射 与 产品/平台组件识别

*此前需求分析做过的工作，架构师不再重复。本节也不写。*

1.  *分析本嵌入式设备上实现的业务场景*
2.  *分解出多项功能需求*

*本节，架构师需要做：*

1.  *将功能需求映射到对应的嵌入式软件的具体组件，并区分它是产品组件还是平台组件。以表格形式呈现。*

*推荐形式：功能与参与功能实现的组件的映射矩阵*

*![](media/780552b6b4ceacfe274a8c687b74a569.png)*

### 平台架构 与 新增/增强组件的位置 【平台侧】

*画出平台架构图，平台尽量黑盒化，不变的组件尽量少体现，重点体现平台侧还要加强的组件，特别标出新增/增强组件的位置。*

### 产品组件 与 各组件说明 【产品侧】

*可采用多种方式：列表格、画UML组件图并辅以文字说明。*

*【示例】*

| *序号* | *模块名称*    | *子模块名称*       | *功能说明*                                                             |
|--------|---------------|--------------------|------------------------------------------------------------------------|
| *1*    |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
| *2*    | *MCU机电模块* | *机电通信模块*     | *实现NMU机电模块与K10主机的通信。*                                     |
|        |               | *电子标签接口模块* | *实现背板EEPROM的电子信息写入和读出。*                                 |
|        |               | *风扇接口模块*     | *通过风扇控制寄存器的访问接口。*                                       |
|        |               | *风扇控制模块*     | *提供对风扇单元转速的控制接口，风扇单元的工作状态和告警信息读取接口。* |
|        |               | *机电应用模块*     | *实现机电信息的收集处理和上报，接收、响应NMU指令。*                    |
|        |               | *机电软件下载模块* | *建立与K10主机机电软件下载会话，实现机电软件模块切割分片传送。*        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
| *3*    |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |
|        |               |                    |                                                                        |

### 产品组件对应的代码工程 与 开发技术 【产品侧】

*说明嵌入式软件（产品侧）包含的多个开发工程（Project）或Makefile。*

*细致地说明，每个组件开发所需的三方库、框架。*

*【示例】*

## 运行视图

### 嵌入式软件：运行架构总览

*说明嵌入式软件运行态下，有哪些进程、线程、以及对应组件的功能简述。*

*【示例】*

| **进程** | **线程** | **组件** | **组件功能** |
|----------|----------|----------|--------------|
|          |          |          |              |
|          |          |          |              |
|          |          |          |              |
|          |          |          |              |
|          |          |          |              |
|          |          |          |              |
|          |          |          |              |
|          |          |          |              |
|          |          |          |              |

### 嵌入式软件中的组件：能否创建线程的准则

*说明嵌入式软件产品侧线程创建的准则：*

-   *哪些情况可以创建线程*
-   *哪些情况杜绝滥启线程★★★*

*后续组件详细设计师必须严格遵守，杜绝线程泛滥拉低性能和易理解性。*

## 物理视图

### 运行环境

*细致地说明，嵌入式的硬件配置。*

*细致地说明操作系统、各种系统软件、中间件的种类和版本。*

*【示例】*

| *硬件环境* *主CPU扣板为P2041，底板核心交换芯片为Qumran的硬件板卡。* *硬件配置* *CPU型号: p2041* *CPU主频：1.5GHz* *CPU核数：4\*e500mc核* *CPU位宽：32位* *内存：4096 MB* *操作系统* *Linux localhost 2.6.34.15-grsec-WR4.3.0.0_cgl \#1 SMP PREEMPT Fri Nov 4 16:51:14 CST 2016 ppc ppc ppc GNU/Linux* |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

### 发布包目录结构及目标路径定义

*本节应描述：*

*A）发布包的详细目录结构约定。*

*B）发布包应该mount到的目标路径*

*【示例】*

*。。。。。。*

### * *组件部署结构

*嵌入式软件往往由许多组件组成，本节重点说明组件之间的上下游关系。*

*【示例】*

# 接口设计

## 对外接口总览

画图，概览本嵌入式软件的对外接口的位置。

## 各模块间接口总览

画图，概览嵌入式软件内部的做个组件之间接口的位置。

## 平台和设备间接口总览

画图，概览平台与设备间接口的位置。

## 接口列表

列出接口名称和功能，对外和内部分别罗列。

## XXXXX接口设计

接口=交互过程+技术选择+格式定义。交互过程用序列图刻画

*【示例1】函数接口的格式定义*

| **名称**                                                                                                                                                                                                                                                             | dhcm回调函数                                      |          |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|----------|
| **用途**                                                                                                                                                                                                                                                             | **DHCM组件提供给DDA的回调接口**                   |          |
| **声明**                                                                                                                                                                                                                                                             |                                                   |          |
| typedef struct tag_dhcm_callback {  INT32 (\*dcoi_board_init)(DCOI_BOARD_INIT_INFO \*init_info);  UINT32 (\*dcoi_get_support_card_flag)();  UINT32 (\*dcoi_cmi_ready_cb)();  VOID (\*dcoi_dhcs_ready)(DHCS_CARD_COMP_INFO_MSG_EN \*card_comp_info);  }DHCM_CALLBACK; |                                                   |          |
| **字段**                                                                                                                                                                                                                                                             | **含义**                                          | **说明** |
| dcoi_board_init                                                                                                                                                                                                                                                      | 嵌入式初始化的调用，包含硬件初始化和软件初始化。  |          |
| dcoi_get_support_card_flag                                                                                                                                                                                                                                           | 返回嵌入式是否支持子卡的信息                      |          |
| dcoi_cmi_ready_cb                                                                                                                                                                                                                                                    | 判断组件cmi是否有值                               |          |
| dcoi_dhcs_ready                                                                                                                                                                                                                                                      | 获取嵌入式建模信息，包含框/槽/子卡/板类型等信息。 |          |

*【示例2】协议接口的格式定义*

![](media/60a0b6815e87242adbc049d64b96e01b.png)

## XXXXX接口设计

接口=交互过程+技术选择+格式定义。交互过程用序列图刻画

# 关键功能的设计原理

*本节内容：*

-   *典型功能的设计*
-   *“2.2.3关键功能识别与问题单分析”节中每个关键功能的设计*

## XXXXX功能设计

*用“*协作图+文字说明*”的方式说明每个关键功能的设计原理。图可以是下列方式之一：*

-   *序列图*
-   *协作图*
-   *涉及多进程多线程的，图中应刻画出“进程/线程”*
-   *设计跨机器分布式的，图中应刻画出“机器/控制板”*
-   *协作逻辑复杂的，图中标号，再针对每个标号进行文字说明*

## XXXXX功能设计

# 关键质量的设计原理

## XXXX设计

### 影响质量的因素分解表/质量因素树

*本节的核心是运用分解思维、系统化思维，梳理影响质量的因素。可采用表格、树等形式。*

### 目标-场景-决策表

*本节的核心是运用场景思维、具体化思维，分析质量因素对系统的具体影响，并给出设计对策。*

*【注意项】推荐使用目标-场景-决策表，表中场景按“质量场景规约”格式编写*

*![](media/c7546c50623e8a8aa6ab33ead8fac6cb.png)*

### 设计原理图

【示例】![](media/e7176066eab77c0cf6e147aed0046ea7.png)

## XXXX设计

### 影响质量的因素分解表/质量因素树

### 目标-场景-决策表

### 设计原理图

## XXXX设计

### 影响质量的因素分解表/质量因素树

### 目标-场景-决策表

### 设计原理图

# 
